
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floor Control System</title>
    <style>
        :root { 
            --primary: #2b3a4a; 
            --secondary: #3f5f6f; 
            --accent: #4fb3bf; 
            --background: linear-gradient(135deg, #2b3a4a 0%, #3f5f6f 100%);
            font-family: "Segoe UI", sans-serif;
        }
        body { 
            font-family: "Segoe UI", sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: var(--background); 
            color: white; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
        }
        .container { max-width: 1200px; margin: 0 auto; flex: 1; width: 100%; box-sizing: border-box; }
        .glass-panel { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; margin: 20px 0; border: 1px solid rgba(255, 255, 255, 0.2); }
        .glass-effect { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; }
        .header-container { display: flex; justify-content: space-between; align-items: center; position: relative; flex-wrap: wrap; gap: 10px; }
        .dropdown-container { display: flex; flex-direction: column; gap: 10px; min-width: 250px; }
        .lock-icon { font-size: 1.5em; cursor: pointer; transition: transform 0.2s ease; }
        .lock-icon:hover { transform: scale(1.1); }
        .staff-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; padding-bottom: 20px; border-bottom: 2px solid rgba(255, 255, 255, 0.3); }
        .staff-badge { padding: 14px 24px; background: rgba(255, 255, 255, 0.15); border-radius: 24px; cursor: pointer; transition: all 0.3s ease; border: 3px solid rgba(255, 255, 255, 0.4); font-size: 1.2em; white-space: nowrap; }
        .staff-badge.selected { border: 4px solid #4fb3bf; background: rgba(79, 179, 191, 0.35); box-shadow: 0 0 15px rgba(79, 179, 191, 0.6); animation: pulse 1.5s infinite; }
        .staff-badge.on-floor { background: rgba(144, 238, 144, 0.2); border-color: #90EE90; }
        .staff-badge.on-break { background: rgba(255, 215, 0, 0.2); border-color: #FFD700; }
        .staff-badge.logged-out { background: rgba(128, 128, 128, 0.2); border-color: #808080; }
        .staff-badge.day-off-leave { background: rgba(255, 0, 0, 0.2); border-color: #FF0000; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(79, 179, 191, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(79, 179, 191, 0); } 100% { box-shadow: 0 0 0 0 rgba(79, 179, 191, 0); } }
        .countdown-timer { font-size: 0.8em; margin-left: 8px; color: rgba(255, 255, 255, 0.7); }
        .stats-panel { display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; margin-top: 20px; }
        .stat-box { background: rgba(255, 255, 255, 0.1); padding: 18px; border-radius: 12px; text-align: center; border: 2px solid rgba(255, 255, 255, 0.15); cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .stat-box:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(79, 179, 191, 0.3); }
        .stat-box.glass-effect-active { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .stat-box.morning-login { background: rgba(135, 206, 235, 0.2); }
        .stat-box.afternoon-login { background: rgba(255, 165, 0, 0.2); }
        .stat-box.on-break { background: rgba(255, 215, 0, 0.2); }
        .stat-box.on-floor { background: rgba(144, 238, 144, 0.2); }
        .stat-box.logged-out { background: rgba(128, 128, 128, 0.2); }
        .stat-box.day-off { background: rgba(255, 0, 0, 0.2); }
        .stat-number { font-size: 2.2em; font-weight: bold; margin: 12px 0; color: var(--accent); font-family: "Segoe UI", sans-serif; }
        .action-buttons { margin: 25px 0; }
        .action-group { display: flex; flex-wrap: wrap; justify-content: space-between; gap: 15px; }
        .track-btn { padding: 10px 20px; border: none; border-radius: 15px; background: rgba(79, 179, 191, 0.3); color: white; cursor: pointer; transition: all 0.2s ease; font-size: 0.9em; border: 2px solid var(--accent); flex: 1; min-width: 100px; }
        .track-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(79, 179, 191, 0.3); }
        .track-btn.login { border-color: #90EE90; }
        .track-btn.logout { border-color: #FF6347; }
        .track-btn.start-break { border-color: #FFD700; }
        .track-btn.end-break { border-color: #FFA500; }
        .analysis-container { margin-top: 15px; max-height: 400px; overflow-y: auto; }
        .day-panel { background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.15); border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        .day-panel h3 { margin: 0 0 10px 0; color: var(--accent); }
        .analysis-table-wrapper { overflow-x: scroll; overflow-y: auto; max-height: 300px; position: relative; -webkit-overflow-scrolling: touch; }
        .analysis-table { width: 100%; border-collapse: collapse; min-width: 800px; background: rgba(128, 128, 128, 0.2); backdrop-filter: blur(10px); border-radius: 10px; table-layout: fixed; }
        .analysis-table th { background: rgba(150, 150, 150, 0.3); position: sticky; top: 0; z-index: 10; padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); text-align: left; }
        .analysis-table td:first-child, .analysis-table th:first-child { position: sticky; left: 0; background: rgba(100, 100, 100, 0.3); z-index: 15; padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); text-align: left; }
        .analysis-table td { padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); text-align: left; }
        .month-selector { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; }
        select { padding: 10px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--accent); color: white; font-size: 1em; flex: 1; }
        .shift-dropdown {
            display: none;
            position: absolute;
            background: rgba(43, 58, 74, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 20;
            padding: 5px 0;
            width: 100px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .shift-option {
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.2s ease, color 0.2s ease;
            color: white;
            text-align: center;
        }
        .shift-option:hover {
            background: rgba(79, 179, 191, 0.4);
            color: #fff;
        }
        .shift-cell {
            cursor: pointer;
            transition: background 0.2s ease;
        }
        .shift-cell:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .shift-cell.active {
            background: rgba(79, 179, 191, 0.3);
        }
        .message { padding: 15px 25px; border-radius: 10px; position: fixed; top: -100px; left: 50%; transform: translateX(-50%); opacity: 0; transition: all 0.5s ease; z-index: 1000; }
        .message.success { background: rgba(144, 238, 144, 0.2); border: 1px solid rgba(144, 238, 144, 0.5); }
        .message.error { background: rgba(255, 99, 71, 0.2); border: 1px solid rgba(255, 99, 71, 0.5); }
        .message.info { background: rgba(79, 179, 191, 0.2); border: 1px solid rgba(79, 179, 191, 0.5); }
        .message.active { opacity: 1; top: 20px; animation: messagePop 4s ease forwards; }
        @keyframes messagePop { 0% { transform: translateX(-50%) scale(0.8); opacity: 0; } 10% { transform: translateX(-50%) scale(1.05); opacity: 1; } 15% { transform: translateX(-50%) scale(1); } 85% { transform: translateX(-50%) scale(1); opacity: 1; } 100% { transform: translateX(-50%) scale(0.8); opacity: 0; } }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1001; }
        .modal-content { background: rgba(43, 58, 74, 0.8); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255, 255, 255, 0.2); animation: slideIn 0.3s ease; font-size: 1.2em; }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-size: 1.8em; color: var(--accent); font-family: "Segoe UI", sans-serif; }
        .modal-close { background: none; border: none; color: white; font-size: 1.8em; cursor: pointer; }
        .modal-form { display: flex; flex-direction: column; gap: 15px; }
        .modal-form input, .modal-form select { padding: 12px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--accent); color: white; font-size: 1.2em; }
        .modal-form button { padding: 12px; border: none; border-radius: 8px; background: var(--accent); color: white; cursor: pointer; font-size: 1.2em; }
        #modalList div { font-size: 1.2em; margin-bottom: 10px; color: white; font-family: "Segoe UI", sans-serif; }
        .roster-table-container { overflow-x: auto; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 15px; padding: 10px; position: relative; }
        .roster-table { width: max-content; border-collapse: collapse; color: white; }
        .roster-table th, .roster-table td { padding: 12px; border: 1px solid rgba(255, 255, 255, 0.2); text-align: center; min-width: 100px; }
        .roster-table th { background: rgba(255, 255, 255, 0.1); position: sticky; top: 0; z-index: 1; }
        .roster-table td:first-child { position: sticky; left: 0; background: rgba(43, 58, 74, 0.8); z-index: 1; }
        .walkie-talkie { display: flex; align-items: center; justify-content: center; gap: 5px; padding: 10px 20px; background: linear-gradient(45deg, #4fb3bf, #2b3a4a); border: none; border-radius: 25px; color: white; font-size: 1em; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; width: 180px; height: 50px; position: relative; }
        .walkie-talkie:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(79, 179, 191, 0.5); }
        .walkie-talkie.active { background: linear-gradient(45deg, #90EE90, #32CD32); }
        .transmission-indicator { position: absolute; top: -5px; right: -5px; width: 10px; height: 10px; background: #32CD32; border-radius: 50%; animation: transmitting 1s infinite; display: none; }
        .walkie-talkie.active .transmission-indicator { display: block; }
        @keyframes transmitting { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.5; } 100% { transform: scale(1); opacity: 1; } }
        .active-count { font-size: 0.8em; margin-left: 5px; color: rgba(255, 255, 255, 0.7); }
        footer { text-align: center; font-size: 0.6em; color: rgba(255, 255, 255, 0.7); padding: 10px 0; animation: fadeInOut 2s infinite; }
        @keyframes fadeInOut { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        @media (max-width: 768px) { 
            .stats-panel { grid-template-columns: repeat(2, 1fr); } 
            .action-group { grid-template-columns: repeat(2, 1fr); gap: 10px; } 
            .track-btn { width: 100%; margin-bottom: 10px; } 
            .staff-badge { padding: 12px 20px; font-size: 1em; } 
            .header-container { flex-direction: column; align-items: flex-start; } 
            .dropdown-container { width: 100%; } 
            .walkie-talkie { width: 100%; max-width: 180px; margin: 10px auto; } 
            .month-selector { flex-direction: column; } 
            .month-selector select, .month-selector .track-btn { width: 100%; } 
            .shift-dropdown { width: 90px; } 
        }
    </style>
</head>
<body>
    <div class="container" id="main-container">
        <div class="glass-panel">
            <div class="header-container">
                <div>
                    <h1 id="store-title">Floor Control</h1>
                    <div id="current-date"></div>
                </div>
                <div class="dropdown-container">
                    <select id="area-select" onchange="updateStoreDropdown()">
                        <option value="Area 1">Area 1</option>
                        <option value="Area 2" selected>Area 2</option>
                        <option value="Area 3">Area 3</option>
                    </select>
                    <select id="store-select" onchange="loadStoreData()">
                        <option value="">Select Store</option>
                    </select>
                    <button class="walkie-talkie" id="walkie-talkie-btn" onmousedown="startWalkieTalkie()" onmouseup="stopWalkieTalkie()" ontouchstart="startWalkieTalkie()" ontouchend="stopWalkieTalkie()">
                        <span>Walkie-Talkie</span> üéôÔ∏è <span class="active-count" id="active-count">0</span>
                        <div class="transmission-indicator"></div>
                    </button>
                </div>
                <span class="lock-icon" style="position: absolute; top: 0; right: 0;" onclick="showLockModal()">üîí</span>
            </div>
        </div>
        <div id="message-container" class="message"></div>
        <div class="glass-panel">
            <h2>Team Members <span id="staff-count" style="color: var(--accent)">(Total: 0)</span></h2>
            <div class="staff-container" id="staff-list"></div>
            <div class="action-buttons">
                <div class="action-group">
                    <button class="track-btn login" onclick="handleLogin()">Login</button>
                    <button class="track-btn logout" onclick="handleLogout()">Logout</button>
                    <button class="track-btn start-break" onclick="handleBreak('start')">Start Break</button>
                    <button class="track-btn end-break" onclick="handleBreak('end')">End Break</button>
                </div>
            </div>
            <hr style="border: 1px solid rgba(255, 255, 255, 0.3); margin: 20px 0;">
            <div class="stats-panel" id="stats-panel">
                <div class="stat-box morning-login" onclick="toggleGlassEffect(this); showStatDetails('Morning Login')">
                    <div>Morning Login</div><div class="stat-number" id="morning-count">0</div>
                </div>
                <div class="stat-box afternoon-login" onclick="toggleGlassEffect(this); showStatDetails('Afternoon Login')">
                    <div>Afternoon Login</div><div class="stat-number" id="afternoon-count">0</div>
                </div>
                <div class="stat-box on-break" onclick="toggleGlassEffect(this); showStatDetails('On Break')">
                    <div>On Break</div><div class="stat-number" id="break-count">0</div>
                </div>
                <div class="stat-box on-floor" onclick="toggleGlassEffect(this); showStatDetails('On Floor')">
                    <div>On Floor</div><div class="stat-number" id="floor-count">0</div>
                </div>
                <div class="stat-box logged-out" onclick="toggleGlassEffect(this); showStatDetails('Logged Out')">
                    <div>Logged Out</div><div class="stat-number" id="left-count">0</div>
                </div>
                <div class="stat-box day-off" onclick="toggleGlassEffect(this); showStatDetails('Day Off')">
                    <div>Day Off / On Leave</div><div class="stat-number" id="day-off-count">0</div>
                </div>
            </div>
            <hr style="border: 1px solid rgba(255, 255, 255, 0.3); margin: 20px 0;">
            <button class="track-btn" style="margin-top: 15px;" onclick="showRosterModal()">Manage Roster</button>
        </div>
        <div class="glass-panel">
            <h2>Attendance Analysis</h2>
            <div class="month-selector">
                <select id="month-select" onchange="updateAnalysis()"></select>
                <select id="date-select" onchange="filterByDate()"></select>
                <button class="track-btn" onclick="refreshData()">Refresh Data</button>
            </div>
            <div class="analysis-container" id="analysis-container"></div>
        </div>
    </div>
    <footer>Designed and Developed by Shankar Neupane | Ver 1.04 | Time Management System</footer>
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Details</h2>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div id="modalList"></div>
        </div>
    </div>
    <div class="modal" id="lockModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Unlock Areas</h2>
                <button class="modal-close" onclick="closeLockModal()">√ó</button>
            </div>
            <div class="modal-form">
                <input type="text" id="unlock-username" placeholder="Area (e.g., Area 1)">
                <input type="password" id="unlock-password" placeholder="Password">
                <button onclick="unlockAreas()">Unlock</button>
            </div>
        </div>
    </div>
    <div class="modal" id="rosterModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Manage Roster</h2>
                <button class="modal-close" onclick="closeRosterModal()">√ó</button>
            </div>
            <div class="roster-table-container">
                <table class="roster-table" id="roster-table">
                    <thead id="roster-table-header"></thead>
                    <tbody id="roster-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCBKQmhnE3E3TmF7UcyuM7NwQyM0FYzL-A",
            authDomain: "breakwatertimemgt.firebaseapp.com",
            databaseURL: "https://breakwatertimemgt-default-rtdb.firebaseio.com/",
            projectId: "breakwatertimemgt",
            storageBucket: "breakwatertimemgt.appspot.com",
            messagingSenderId: "806149652458",
            appId: "1:806149652458:web:d97884f60d2ff4644b7c93"
        };
        firebase.initializeApp(firebaseConfig);
        let selectedStaff = null;
        let currentData = {};
        let activeBreaks = {};
        let selectedArea = 'Area 2';
        let selectedStore = null;
        let staffList = [];
        let unlockedAreas = ['Area 2'];
        let loggedInUser = 'user_' + Math.random().toString(36).substr(2, 9);
        let activePages = 0;
        let localStream = null;
        let peerConnections = {};
        let isTransmitting = false;
        const areas = {
            "Area 1": {
                "Al Ghurair Centre": ["Melani", "Jayson", "Helen", "Arlene", "Al", "Dipesh"],
                "Burjuman": ["Sanjay", "Muhammed", "Shadab", "Manuel", "Sanjeev", "Janeth", "Naneth", "Evangeline", "Tin", "Muhamed", "Roselyn", "Liezel", "Robin", "Faizan"],
                "Deira City Centre": ["Sanjay", "Surya", "Mudassar", "Kyza", "Sunil", "Marcianco", "Marciel", "Joel", "Bishal", "Leofris", "Jasmine", "Yanden", "Juslyn", "Katrina", "Ezaz", "Maricar", "Anish", "Awad", "Sima", "Keshov", "Christina"],
                "Dubai Festival City": ["Ramesh", "Elvin", "Mohamed", "Manivannan", "Jay", "Leonito", "Jackielyn", "Janieca"],
                "Dubai Hills": ["Cristine", "Unnikrishnan", "Allan", "Saddam", "Rajiv", "Camille", "Annmae", "Mir", "Lelin", "Darwen", "Jamilla", "Gyani", "Anurag", "Damandeep", "Krishna"],
                "Dubai Mall": ["Mohamed", "Rosalinda", "Mylene", "Babylyn", "Milan", "Anshul", "Bibek", "Leah", "Kewal", "Saroj", "Yoon", "Mahtab", "Ma.Medalya", "Sudhan", "Nomilyn", "Su", "Passang"],
                "Ibn Battuta": ["Sureshwar", "Margie", "Mary", "Blair", "Chera", "Amaya", "Bishal", "Dinesh", "Babul", "Sabina", "Muschirniel"],
                "Mall of Emirates": ["Mohammed", "Ubaid", "Tank", "Cherrie", "Jennifer", "Rachelle", "Mary", "Manisha", "Hari", "Swechchha", "Birson", "Shekher", "Prashanth", "Subrata", "passang", "Swastika", "Mina", "Gilbee", "ABERT", "Ajib", "Fatima", "Alisha", "Junnu", "Suraj", "Amit", "Pema", "Chandra", "Juphet", "Nikki", "Nerilyn"],
                "Mirdiff City Centre": ["Nasim", "Samuela", "Mary", "Sharwan", "Ruben", "Santosh", "ASGAR", "Rejin", "Tuhin", "Bikram", "Kean", "Ritika", "Zuned", "Claret", "Sultan", "Yeshi", "Zahoor", "Sanju", "Miecka", "Sumina", "Isuru"],
                "Oasis Centre Dubai": ["Nishant", "Asif", "Sunita", "Casiraj", "Diovelyn", "Shabbir", "Silpa", "Ashok", "Junard", "Mohammed"],
                "Shoemart Outlet Mall": ["Obed", "Chetan", "Francisco", "Rajendra", "Khagendra", "Mohammed", "Kishor", "Philip", "Chand", "Dipesh", "Tibendra", "Khurram", "Mohammad"]
            },
            "Area 2": {
                "Marina Mall": ["Shankar", "Joveheldo", "Mary", "Jessel", "MohammedZ", "Victoria", "Girlie", "Rohit", "Rolly", "Swetshel"],
                "Al-Ain Mall": ["Virendra", "Janice", "Dambar", "Marshal", "Rubina", "Rogelio", "Chris", "Mohamed", "Bishnu", "Leena"],
                "City Mall": ["Catherine", "Mary", "Mohamed", "Shiela", "Mhar", "Ram", "Ankit"],
                "Bawabat Store": ["Jeena", "Gelynbee", "Mar-Jay", "Miraj", "John", "Anisha", "Jacqueline", "Mohammed", "Angelica"],
                "Bawadi Mall": ["Sunny", "Pushpa", "Augustin", "Mohamed", "Ashmita", "Kezang", "Aashik", "Mahra", "KASHISH", "Karim", "Jemmalyn", "Khila", "Ravi", "Marlou"],
                "Dalma Mall": ["Zahid", "Ellen", "Drianne", "Asmaa", "Vipan", "Mohammed", "Armila", "Jesica", "Marian", "Maria", "Durga", "Jayvin"],
                "Deerfields Mall": ["John", "Allen", "Ramiz", "Siphora"],
                "Jimmi Mall": ["Eloysa", "Mohamed", "Mohamed", "April", "SALVADOR", "Mahmoud", "Sanu", "Maitha", "Waneya", "Sanjaya", "Sajani"],
                "World Trade Centre": ["Jerricho", "Gerlie", "Jacob", "Udawelagedara", "Nerissa"],
                "Yas Mall": ["Ireen", "Juvy", "Sandar", "Jemerie", "Abdul", "Ernielyn", "James", "Ricleen", "Sarah", "Neelam"],
                "Reem Mall": ["John", "Grece", "Nympha", "Kavindhya", "Akire"],
                "Al Maryah Central": ["Rachel", "Riza", "Mahammad", "Diosee", "Rojana", "Austria", "Rojan", "Justin"],
                "Al Ruwais Mall": ["Thaman", "Upasna", "Rabi", "Vina", "Mahesh"],
                "Alwahda Mall": ["Jay-D", "Jamyang", "Bibek", "John", "Naresh", "Charol"]
            },
            "Area 3": {
                "Al Zahia Centre": ["Roshan", "Ameet", "Monica", "Bishal", "Priyanka", "Melvin", "Angelica", "Michille", "Rubi", "Meera", "Mohammed", "Aamosh"],
                "Sahara Centre": ["Flordelis", "Ujjwal", "Ira", "Rhelmart", "Analyn", "Yudha", "Sandip"],
                "Ajman City Centre": ["Rajesh", "Balaram", "Nagie", "Lorie", "Yogendra", "Mohamed", "Shradha", "Shreejan", "Vishnu", "Prakash", "Saif", "Elizabeth", "Mohamed"],
                "Ajman Corniche": ["Pawan", "Shanell", "Bishal", "Ruth", "Swastika", "Lea"],
                "Fujairah": ["Shiela", "Ekramul", "Oscar", "Karan", "Crisalie", "Said", "Padma", "Adhari", "Benjar"],
                "Fujeira City Centre": ["Pratik", "Don", "Virginia", "Monica", "Nischal", "Sudha", "Shoshin", "Habeisha", "Leah"],
                "Oasis Centre Sharjah": ["Rajib", "Marvina", "Ravi", "Jevian", "Sanjay", "Warnakulasuriya"],
                "RAK Bin Dhahar": ["Bijendra", "Arif", "Jacqueline", "Mohammed", "Mary", "Mohammad", "Donalyn", "Maryam", "Angel", "NWE", "Shahd"],
                "Ras Al Khaima": ["Datsun", "Laxmi", "Jonalyne", "Harshdeep", "Sanjita", "Shahan", "Heba", "Divina", "Wafa", "Abdullah"],
                "Sharjah CC": ["Suraj", "Samiran", "Ezra", "Abu", "Chris", "Elvie", "Sarnim", "Mohammed", "Maham", "Mohamad", "Anil", "Nur", "Rodel", "Nirmal"]
            }
        };
        document.addEventListener('DOMContentLoaded', () => {
            initDate();
            updateStoreDropdown();
            loadStoreData();
            initMonthSelector();
            updateActiveCount();
            setupWebRTC();
            document.addEventListener('click', closeShiftDropdown);
        });
        function initDate() { document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }); }
        function updateStoreDropdown() {
            selectedArea = document.getElementById('area-select').value;
            const storeSelect = document.getElementById('store-select');
            storeSelect.innerHTML = '<option value="">Select Store</option>' + Object.keys(areas[selectedArea]).map(store => `<option value="${store}">${store}</option>`).join('');
            if (selectedStore) storeSelect.value = selectedStore;
            loadStoreData();
        }
        function loadStoreData() {
            selectedStore = document.getElementById('store-select').value;
            if (!selectedStore) {
                document.getElementById('staff-list').innerHTML = '<p>Please select a store</p>';
                document.getElementById('staff-count').textContent = "(Total: 0)";
                document.getElementById('store-title').textContent = "Floor Control";
                return;
            }
            staffList = areas[selectedArea][selectedStore] || [];
            document.getElementById('store-title').textContent = `${selectedStore} - Floor Control`;
            document.getElementById('staff-count').textContent = `(Total: ${staffList.length})`;
            renderStaff();
            firebase.database().ref(`stores/${selectedArea}/${selectedStore}`).on('value', snapshot => {
                const data = snapshot.val() || {};
                currentData = data.data || {};
                activeBreaks = data.breaks || {};
                updateStaffAndStats();
                renderRosterTable();
            });
            firebase.database().ref('users').child(loggedInUser).update({ area: selectedArea, store: selectedStore });
            setupWebRTC();
        }
        function toggleGlassEffect(element) { element.classList.toggle('glass-effect-active'); }
        function renderStaff() {
            if (!staffList.length) {
                document.getElementById('staff-list').innerHTML = '<p>No staff available</p>';
                return;
            }
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('staff-list').innerHTML = staffList.map(staff => {
                const data = currentData[today]?.[staff] || {};
                const shift = currentData['shifts']?.[today]?.[staff];
                let statusClass = '';
                let countdown = '';
                if (activeBreaks[staff]?.active) {
                    const diff = new Date(activeBreaks[staff].endTime) - new Date();
                    if (diff > 0) {
                        const mins = Math.floor(diff / 60000);
                        const secs = Math.floor((diff % 60000) / 1000);
                        countdown = `<span class="countdown-timer">${mins}m ${secs}s</span>`;
                        statusClass = 'on-break';
                    }
                } else if (data.login && !data.logout) {
                    statusClass = 'on-floor';
                } else if (data.logout) {
                    statusClass = 'logged-out';
                } else if (shift === 'DAY OFF' || shift === 'LEAVE') {
                    statusClass = 'day-off-leave';
                }
                return `<div class="staff-badge ${selectedStaff === staff ? 'selected' : ''} ${statusClass}" onclick="selectStaff('${staff}')">${staff}${countdown}</div>`;
            }).join('');
        }
        function selectStaff(staff) { selectedStaff = staff; renderStaff(); }
        function handleLogin() {
            if (!selectedStaff) return showMessage('Select a staff member', 'error');
            const today = new Date().toISOString().split('T')[0];
            currentData[today] = currentData[today] || {};
            currentData[today][selectedStaff] = currentData[today][selectedStaff] || {};
            currentData[today][selectedStaff].login = new Date().toISOString();
            updateStaffAndStats();
            updateAnalysis();
            showMessage(`${selectedStaff} logged in`, 'success');
            saveData();
        }
        function handleLogout() {
            if (!selectedStaff) return showMessage('Select a staff member', 'error');
            if (!currentData[new Date().toISOString().split('T')[0]]?.[selectedStaff]?.login) return showMessage('Select a logged-in staff', 'error');
            const today = new Date().toISOString().split('T')[0];
            currentData[today][selectedStaff].logout = new Date().toISOString();
            delete activeBreaks[selectedStaff];
            updateStaffAndStats();
            updateAnalysis();
            showMessage(`${selectedStaff} logged out`, 'success');
            saveData();
        }
        function handleBreak(action) {
            if (!selectedStaff) return showMessage('Select a staff member', 'error');
            const today = new Date().toISOString().split('T')[0];
            currentData[today] = currentData[today] || {};
            currentData[today][selectedStaff] = currentData[today][selectedStaff] || {};
            currentData[today][selectedStaff].breaks = currentData[today][selectedStaff].breaks || [];
            if (action === 'start') {
                if (activeBreaks[selectedStaff]?.active) return showMessage(`${selectedStaff} is on break`, 'error');
                const startTime = new Date().toISOString();
                currentData[today][selectedStaff].breaks.push({ start: startTime, end: null });
                activeBreaks[selectedStaff] = { active: true, start: startTime, endTime: new Date(Date.now() + 3600000).toISOString() };
                updateStaffAndStats();
                updateAnalysis();
                showMessage(`${selectedStaff} started break`, 'success');
                saveData();
            } else {
                if (!activeBreaks[selectedStaff]?.active) return showMessage(`${selectedStaff} is not on break`, 'error');
                const lastBreak = currentData[today][selectedStaff].breaks.find(b => b.start === activeBreaks[selectedStaff].start && !b.end);
                lastBreak.end = new Date().toISOString();
                delete activeBreaks[selectedStaff];
                updateStaffAndStats();
                updateAnalysis();
                showMessage(`${selectedStaff} ended break`, 'success');
                saveData();
            }
        }
        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const entries = currentData[today] || {};
            let morningCount = 0, afternoonCount = 0, breakCount = 0, floorCount = 0, loggedOutCount = 0, dayOffCount = 0;
            staffList.forEach(staff => {
                const data = entries[staff] || {};
                const shift = currentData['shifts']?.[today]?.[staff];
                if (data.login) {
                    new Date(data.login).getHours() < 12 ? morningCount++ : afternoonCount++;
                    if (!data.logout) {
                        activeBreaks[staff]?.active ? breakCount++ : floorCount++;
                    } else {
                        loggedOutCount++;
                    }
                }
                if (shift === 'DAY OFF' || shift === 'LEAVE') {
                    dayOffCount++;
                }
            });
            document.getElementById('morning-count').textContent = morningCount;
            document.getElementById('afternoon-count').textContent = afternoonCount;
            document.getElementById('break-count').textContent = breakCount;
            document.getElementById('floor-count').textContent = floorCount;
            document.getElementById('left-count').textContent = loggedOutCount;
            document.getElementById('day-off-count').textContent = dayOffCount;
        }
        async function saveData() {
            if (selectedStore) {
                await firebase.database().ref(`stores/${selectedArea}/${selectedStore}`).set({
                    data: currentData,
                    breaks: activeBreaks,
                    unlockedAreas
                });
            }
        }
        function initMonthSelector() {
            const monthSelect = document.getElementById('month-select');
            const currentDate = new Date();
            monthSelect.innerHTML = Array.from({ length: 12 }, (_, i) => {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                const value = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                return `<option value="${value}">${date.toLocaleString('default', { month: 'long', year: 'numeric' })}</option>`;
            }).join('');
            monthSelect.value = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
            updateAnalysis();
        }
        function updateAnalysis() {
            const [year, month] = document.getElementById('month-select').value.split('-');
            const daysInMonth = new Date(year, month, 0).getDate();
            const today = new Date().toISOString().split('T')[0];
            const monthData = Array.from({ length: daysInMonth }, (_, i) => {
                const date = `${year}-${month}-${String(i + 1).padStart(2, '0')}`;
                if (date > today) return null;
                const rows = staffList.map(staff => {
                    const data = currentData[date]?.[staff] || {};
                    const shift = currentData['shifts']?.[date]?.[staff];
                    const totalBreakMs = (data.breaks || []).reduce((sum, b) => b.start && b.end ? sum + (new Date(b.end) - new Date(b.start)) : sum, 0);
                    const totalWorkedMs = data.login && data.logout ? (new Date(data.logout) - new Date(data.login)) : 0;
                    const lastBreak = data.breaks?.length ? data.breaks[data.breaks.length - 1] : null;
                    return {
                        staff,
                        plannedShift: shift || '-',
                        loginTime: data.login ? formatTime(new Date(data.login)) : shift === 'DAY OFF' ? 'Day Off' : shift === 'LEAVE' ? 'On Leave' : '-',
                        startBreak: lastBreak?.start ? formatTime(new Date(lastBreak.start)) : '-',
                        endBreak: lastBreak?.end ? formatTime(new Date(lastBreak.end)) : '-',
                        logoutTime: data.logout ? formatTime(new Date(data.logout)) : '-',
                        totalWorkedHours: totalWorkedMs > 0 ? (totalWorkedMs / 3600000).toFixed(2) + 'h' : '-',
                        totalBreakHours: totalBreakMs > 0 ? (totalBreakMs / 60000).toFixed(0) + 'm' : '-'
                    };
                }).filter(row => row.loginTime !== '-' || row.plannedShift !== '-');
                return rows.length ? { date, rows } : null;
            }).filter(Boolean).sort((a, b) => b.date.localeCompare(a.date));
            const dateSelect = document.getElementById('date-select');
            dateSelect.innerHTML = '<option value="">All Dates</option>' + monthData.map(day => `<option value="${day.date}">${day.date}</option>`).join('');
            renderAnalysis(monthData);
        }
        function renderAnalysis(data) {
            document.getElementById('analysis-container').innerHTML = data.map(day => `
                <div class="day-panel">
                    <h3>${day.date}</h3>
                    <div class="analysis-table-wrapper">
                        <table class="analysis-table">
                            <thead>
                                <tr>
                                    <th>Staff</th>
                                    <th>Shift</th>
                                    <th>Login</th>
                                    <th>Start Break</th>
                                    <th>End Break</th>
                                    <th>Logout</th>
                                    <th>Total Hours</th>
                                    <th>Break Hours</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${day.rows.map(row => `
                                    <tr>
                                        <td>${row.staff}</td>
                                        <td>${row.plannedShift}</td>
                                        <td>${row.loginTime}</td>
                                        <td>${row.startBreak}</td>
                                        <td>${row.endBreak}</td>
                                        <td>${row.logoutTime}</td>
                                        <td>${row.totalWorkedHours}</td>
                                        <td>${row.totalBreakHours}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `).join('');
        }
        function filterByDate() {
            const selectedDate = document.getElementById('date-select').value;
            updateAnalysis();
            if (selectedDate) {
                const filtered = Array.from(document.querySelectorAll('.day-panel')).filter(panel => panel.querySelector('h3').textContent === selectedDate).map(panel => panel.outerHTML).join('');
                document.getElementById('analysis-container').innerHTML = filtered || '<p>No data for this date</p>';
            }
        }
        function formatTime(date) { return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }); }
        function showMessage(text, type = 'success') {
            const msg = document.getElementById('message-container');
            msg.textContent = text;
            msg.className = `message ${type} active`;
            setTimeout(() => msg.classList.remove('active'), 4000);
        }
        function updateStaffAndStats() { renderStaff(); updateStats(); }
        function showStatDetails(title) {
            const today = new Date().toISOString().split('T')[0];
            const entries = currentData[today] || {};
            let items = [];
            switch (title) {
                case 'Morning Login': items = staffList.filter(s => entries[s]?.login && new Date(entries[s].login).getHours() < 12); break;
                case 'Afternoon Login': items = staffList.filter(s => entries[s]?.login && new Date(entries[s].login).getHours() >= 12); break;
                case 'On Break': items = staffList.filter(s => activeBreaks[s]?.active); break;
                case 'On Floor': items = staffList.filter(s => entries[s]?.login && !entries[s]?.logout && !activeBreaks[s]?.active); break;
                case 'Logged Out': items = staffList.filter(s => entries[s]?.logout); break;
                case 'Day Off': items = staffList.filter(s => currentData['shifts']?.[today]?.[s] === 'DAY OFF' || currentData['shifts']?.[today]?.[s] === 'LEAVE'); break;
            }
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalList').innerHTML = items.length ? items.map(item => `<div>${item}</div>`).join('') : '<div>No staff</div>';
            document.getElementById('detailModal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('detailModal').style.display = 'none'; }
        function showLockModal() { document.getElementById('lockModal').style.display = 'flex'; }
        function closeLockModal() { document.getElementById('lockModal').style.display = 'none'; }
        async function unlockAreas() {
            const area = document.getElementById('unlock-username').value;
            const password = document.getElementById('unlock-password').value;
            if (Object.keys(areas).includes(area) && password === '1111' && !unlockedAreas.includes(area)) {
                unlockedAreas.push(area);
                document.getElementById('area-select').innerHTML = unlockedAreas.map(a => `<option value="${a}" ${a === selectedArea ? 'selected' : ''}>${a}</option>`).join('');
                await saveData();
                showMessage(`${area} unlocked`, 'success');
                closeLockModal();
            } else {
                showMessage('Invalid credentials or area already unlocked', 'error');
            }
        }
        function showRosterModal() { 
            if (!selectedStore) return showMessage('Please select a store first', 'error');
            document.getElementById('rosterModal').style.display = 'flex'; 
            renderRosterTable(); 
        }
        function closeRosterModal() { document.getElementById('rosterModal').style.display = 'none'; }
        function renderRosterTable() {
            const today = new Date();
            const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay() + 1));
            const dates = Array.from({ length: 7 }, (_, i) => {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                return date.toISOString().split('T')[0];
            });
            const header = document.getElementById('roster-table-header');
            header.innerHTML = `<tr><th>Staff</th>${dates.map(date => `<th>${new Date(date).toLocaleDateString('en-US', { weekday: 'short', day: 'numeric' })}</th>`).join('')}</tr>`;
            const body = document.getElementById('roster-table-body');
            body.innerHTML = staffList.map(staff => `
                <tr>
                    <td>${staff}</td>
                    ${dates.map(date => `
                        <td class="shift-cell" onclick="showShiftDropdown(event, '${staff}', '${date}')">
                            ${currentData['shifts']?.[date]?.[staff] || '-'}
                        </td>
                    `).join('')}
                </tr>
            `).join('');
        }
        let activeDropdown = null;
        function showShiftDropdown(event, staff, date) {
            event.stopPropagation();
            if (!selectedStore) {
                showMessage('Please select a store first', 'error');
                return;
            }
            if (activeDropdown) {
                activeDropdown.remove();
                activeDropdown = null;
            }
            const shiftOptions = ['AM', 'PM', 'MID', 'DAY OFF', 'LEAVE', 'SICK', 'STK'];
            const cell = event.target;
            const dropdown = document.createElement('div');
            dropdown.className = 'shift-dropdown';
            dropdown.innerHTML = shiftOptions.map(option => `
                <div class="shift-option">${option}</div>
            `).join('');
            const rect = cell.getBoundingClientRect();
            const tableContainer = document.querySelector('.roster-table-container');
            const containerRect = tableContainer.getBoundingClientRect();
            dropdown.style.top = `${rect.bottom - containerRect.top + tableContainer.scrollTop}px`;
            dropdown.style.left = `${rect.left - containerRect.left + tableContainer.scrollLeft}px`;
            tableContainer.appendChild(dropdown);
            dropdown.style.display = 'block';
            activeDropdown = dropdown;
            cell.classList.add('active');
            dropdown.addEventListener('click', (e) => {
                const option = e.target.closest('.shift-option');
                if (option) {
                    const selectedShift = option.textContent;
                    selectShift(staff, date, selectedShift, cell);
                }
            });
            dropdown.addEventListener('click', (e) => e.stopPropagation());
        }
        async function selectShift(staff, date, shift, cell) {
            currentData['shifts'] = currentData['shifts'] || {};
            currentData['shifts'][date] = currentData['shifts'][date] || {};
            currentData['shifts'][date][staff] = shift;
            if (cell) {
                cell.textContent = shift;
                cell.classList.remove('active');
            }
            updateStaffAndStats();
            updateAnalysis();
            showMessage(`Shift updated for ${staff} on ${date} to ${shift}`, 'success');
            await saveData();
            if (activeDropdown) {
                activeDropdown.remove();
                activeDropdown = null;
            }
        }
        function closeShiftDropdown(event) {
            if (activeDropdown && !activeDropdown.contains(event.target)) {
                const activeCell = document.querySelector('.shift-cell.active');
                if (activeCell) activeCell.classList.remove('active');
                activeDropdown.remove();
                activeDropdown = null;
            }
        }
        function setupWebRTC() {
            if (!selectedStore) return;
            const db = firebase.database();
            const signalingPath = `walkie/${selectedArea}/${selectedStore}/signaling`;
            const usersPath = `walkie/${selectedArea}/${selectedStore}/users`;

            // Clean up existing connections
            Object.values(peerConnections).forEach(pc => pc.close());
            peerConnections = {};

            const configuration = {
                iceServers: [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { urls: 'turn:openrelay.metered.ca:80', username: 'openrelayproject', credential: 'openrelayproject' }
                ]
            };

            // Register this user
            db.ref(usersPath).child(loggedInUser).set({ timestamp: firebase.database.ServerValue.TIMESTAMP });
            db.ref(usersPath).child(loggedInUser).onDisconnect().remove();

            // Handle all active users
            db.ref(usersPath).on('value', snapshot => {
                const users = snapshot.val() || {};
                const userIds = Object.keys(users).filter(id => id !== loggedInUser);

                // Close connections for users who left
                Object.keys(peerConnections).forEach(userId => {
                    if (!userIds.includes(userId)) {
                        peerConnections[userId].close();
                        delete peerConnections[userId];
                    }
                });

                // Create connections for new users
                userIds.forEach(userId => {
                    if (!peerConnections[userId]) {
                        const pc = new RTCPeerConnection(configuration);
                        peerConnections[userId] = pc;

                        pc.onicecandidate = event => {
                            if (event.candidate) {
                                db.ref(`${signalingPath}/${loggedInUser}/${userId}/candidates`).push(event.candidate);
                            }
                        };
                        pc.ontrack = event => {
                            const audio = new Audio();
                            audio.srcObject = event.streams[0];
                            audio.autoplay = true;
                            audio.play().catch(err => console.error('Audio playback error:', err));
                        };
                        if (localStream) {
                            localStream.getTracks().forEach(track => pc.addTrack(track, localStream));
                        }

                        // Only initiate offer if this user's ID is smaller
                        if (loggedInUser < userId) {
                            pc.createOffer()
                                .then(offer => pc.setLocalDescription(offer))
                                .then(() => db.ref(`${signalingPath}/${loggedInUser}/${userId}`).set({ offer: pc.localDescription }))
                                .catch(err => console.error('Offer creation error:', err));
                        }
                    }
                });

                // Update active count
                activePages = Object.keys(users).length;
                document.getElementById('active-count').textContent = activePages;
            });

            // Handle incoming signaling
            db.ref(`${signalingPath}/${loggedInUser}`).on('value', snapshot => {
                const data = snapshot.val() || {};
                Object.keys(data).forEach(fromUserId => {
                    if (fromUserId === loggedInUser) return;

                    let pc = peerConnections[fromUserId];
                    if (!pc) {
                        pc = new RTCPeerConnection(configuration);
                        peerConnections[fromUserId] = pc;
                        pc.onicecandidate = event => {
                            if (event.candidate) {
                                db.ref(`${signalingPath}/${fromUserId}/${loggedInUser}/candidates`).push(event.candidate);
                            }
                        };
                        pc.ontrack = event => {
                            const audio = new Audio();
                            audio.srcObject = event.streams[0];
                            audio.autoplay = true;
                            audio.play().catch(err => console.error('Audio playback error:', err));
                        };
                        if (localStream) {
                            localStream.getTracks().forEach(track => pc.addTrack(track, localStream));
                        }
                    }

                    const userData = data[fromUserId];
                    if (userData.offer && pc.signalingState === 'stable') {
                        pc.setRemoteDescription(new RTCSessionDescription(userData.offer))
                            .then(() => pc.createAnswer())
                            .then(answer => pc.setLocalDescription(answer))
                            .then(() => db.ref(`${signalingPath}/${loggedInUser}/${fromUserId}`).set({ answer: pc.localDescription }))
                            .catch(err => console.error('Offer handling error:', err));
                    } else if (userData.answer && pc.signalingState === 'have-local-offer') {
                        pc.setRemoteDescription(new RTCSessionDescription(userData.answer))
                            .catch(err => console.error('Answer handling error:', err));
                    }
                });
            });

            // Handle ICE candidates
            db.ref(`${signalingPath}/${loggedInUser}`).on('child_added', snapshot => {
                const fromUserId = snapshot.key;
                if (fromUserId === loggedInUser) return;
                db.ref(`${signalingPath}/${fromUserId}/${loggedInUser}/candidates`).on('child_added', snap => {
                    const candidate = snap.val();
                    if (candidate && peerConnections[fromUserId]) {
                        peerConnections[fromUserId].addIceCandidate(new RTCIceCandidate(candidate))
                            .catch(err => console.error('ICE candidate error:', err));
                    }
                });
            });
        }
        async function startWalkieTalkie() {
            if (!selectedStore) return showMessage('Select a store', 'error');
            if (isTransmitting) return;
            isTransmitting = true;
            document.getElementById('walkie-talkie-btn').classList.add('active');
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                Object.values(peerConnections).forEach(pc => {
                    localStream.getTracks().forEach(track => {
                        if (!pc.getSenders().find(sender => sender.track === track)) {
                            pc.addTrack(track, localStream);
                        }
                    });
                });
            } catch (err) {
                console.error('Error accessing microphone:', err);
                showMessage('Microphone access denied', 'error');
                stopWalkieTalkie();
            }
        }
        function stopWalkieTalkie() {
            if (!isTransmitting) return;
            isTransmitting = false;
            document.getElementById('walkie-talkie-btn').classList.remove('active');
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            Object.values(peerConnections).forEach(pc => {
                pc.getSenders().forEach(sender => pc.removeTrack(sender));
            });
        }
        function updateActiveCount() {
            if (!selectedStore) return;
            firebase.database().ref(`walkie/${selectedArea}/${selectedStore}/users`).on('value', snapshot => {
                const users = snapshot.val() || {};
                activePages = Object.keys(users).length;
                document.getElementById('active-count').textContent = activePages;
            });
        }
        function refreshData() { loadStoreData(); updateStaffAndStats(); updateAnalysis(); showMessage('Data refreshed', 'info'); }
        setInterval(() => { if (Object.keys(activeBreaks).length) { renderStaff(); } }, 1000);
    </script>
</body>
</html>
